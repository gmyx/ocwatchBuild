import{s as Te,e as te,J as me,a as b,d as re,t as Se,K as ue,c as T,f as d,i as W,j as h,k as ee,L as Fe,n as Z,b as pe,h as Re,g as Ee,l as _e,m as Ce,o as qe,p as Ie,q as de}from"../chunks/scheduler.CwZefb0o.js";import{S as ke,i as De,b as S,d as F,m as k,t as u,a as $,c as ie,e as D,g as ne}from"../chunks/index.RfiDZozx.js";import{D as $e,m as X}from"../chunks/VennDiagram.svelte_svelte_type_style_lang.D5SiE8nu.js";import{v as Me,w as Le}from"../chunks/entry.CLsv0ICV.js";import{s as Ge,Q as U,p as Qe,r as ce,C as Ae,t as ge}from"../chunks/inferColumnTypes.CZSR8CUR.js";import{h as J}from"../chunks/setTrackProxy.Cyfckp0w.js";import{e as Oe,p as Ne}from"../chunks/inputs.uqKFdAxO.js";import{D as we,a as He}from"../chunks/Dropdown.sBO35P-m.js";import{p as Pe}from"../chunks/stores.DybgH1qU.js";import{Q as oe}from"../chunks/QueryViewer.DbhmcTXQ.js";import{P as je}from"../chunks/PointMap.lO9i8YSx.js";function Be(i){let r,s,e,l;return{c(){r=te("p"),s=me(i[0]),e=b(),l=me(i[2]),this.h()},l(m){r=re(m,"P",{class:!0,title:!0});var o=Se(r);s=ue(o,i[0]),e=T(o),l=ue(o,i[2]),o.forEach(d),this.h()},h(){W(r,"class","text-sm py-1 cursor-text"),W(r,"title",new Date(i[1]).toLocaleString())},m(m,o){h(m,r,o),ee(r,s),ee(r,e),ee(r,l)},p(m,[o]){o&1&&Fe(s,m[0])},i:Z,o:Z,d(m){m&&d(r)}}}function Ue(i,r){const s=Math.floor((r-i)/1e3);if(s<60)return s===1?"1 second ago":`${s} seconds ago`;if(s<3600){const e=Math.round(s/60);return e===1?"1 min ago":`${e} mins ago`}else if(s<86400){const e=(s/3600).toFixed(1);return e==="1"?"1 hour ago":`${e} hours ago`}else if(s<604800){const e=Math.round(s/86400);return e===1?"1 day ago":`${e} days ago`}else if(s<2592e3){const e=Math.round(s/604800);return e===1?"1 week ago":`${e} weeks ago`}else if(s<31536e3){const e=Math.round(s/2592e3);return e===1?"1 month ago":`${e} months ago`}else{const e=Math.round(s/31536e3);return e===1?"1 year ago":`${e} years ago`}}function Ye(i,r,s){const e=Number(Me);let{prefix:l="Last refreshed"}=r;const m=Ue(e,Date.now());return i.$$set=o=>{"prefix"in o&&s(0,l=o.prefix)},[l,e,m]}class ze extends ke{constructor(r){super(),De(this,r,Ye,Be,Te,{prefix:0})}}function Ke(i){return{c(){this.h()},l(r){this.h()},h(){document.title="Evidence"},m:Z,p:Z,d:Z}}function ve(i){let r,s;return r=new oe({props:{queryID:"rawdata",queryResult:i[1]}}),{c(){S(r.$$.fragment)},l(e){F(r.$$.fragment,e)},m(e,l){k(r,e,l),s=!0},p(e,l){const m={};l[0]&2&&(m.queryResult=e[1]),r.$set(m)},i(e){s||(u(r.$$.fragment,e),s=!0)},o(e){$(r.$$.fragment,e),s=!1},d(e){D(r,e)}}}function he(i){let r,s;return r=new oe({props:{queryID:"trips_shapeid",queryResult:i[2]}}),{c(){S(r.$$.fragment)},l(e){F(r.$$.fragment,e)},m(e,l){k(r,e,l),s=!0},p(e,l){const m={};l[0]&4&&(m.queryResult=e[2]),r.$set(m)},i(e){s||(u(r.$$.fragment,e),s=!0)},o(e){$(r.$$.fragment,e),s=!1},d(e){D(r,e)}}}function ye(i){let r,s;return r=new oe({props:{queryID:"timestamps",queryResult:i[3]}}),{c(){S(r.$$.fragment)},l(e){F(r.$$.fragment,e)},m(e,l){k(r,e,l),s=!0},p(e,l){const m={};l[0]&8&&(m.queryResult=e[3]),r.$set(m)},i(e){s||(u(r.$$.fragment,e),s=!0)},o(e){$(r.$$.fragment,e),s=!1},d(e){D(r,e)}}}function be(i){let r,s;return r=new oe({props:{queryID:"routes",queryResult:i[4]}}),{c(){S(r.$$.fragment)},l(e){F(r.$$.fragment,e)},m(e,l){k(r,e,l),s=!0},p(e,l){const m={};l[0]&16&&(m.queryResult=e[4]),r.$set(m)},i(e){s||(u(r.$$.fragment,e),s=!0)},o(e){$(r.$$.fragment,e),s=!1},d(e){D(r,e)}}}function Ve(i){let r,s,e,l,m,o,R,L,f,C,E,q,y,O;return r=new X({props:{id:"run_timestamp",title:"Runtime",fmt:"yyyy/mm/dd hh:MM:ss.000"}}),e=new X({props:{id:"run_id",title:"Run ID"}}),m=new X({props:{id:"position_bearing",title:"Bearing"}}),R=new X({props:{id:"Position_lon",title:"Longitude",fmt:"###.##############"}}),f=new X({props:{id:"position_lat",title:"Latitute",fmt:"###.##############"}}),E=new X({props:{id:"trip_route",title:"Route #"}}),y=new X({props:{id:"vehicle_id",title:"Bus #"}}),{c(){S(r.$$.fragment),s=b(),S(e.$$.fragment),l=b(),S(m.$$.fragment),o=b(),S(R.$$.fragment),L=b(),S(f.$$.fragment),C=b(),S(E.$$.fragment),q=b(),S(y.$$.fragment)},l(a){F(r.$$.fragment,a),s=T(a),F(e.$$.fragment,a),l=T(a),F(m.$$.fragment,a),o=T(a),F(R.$$.fragment,a),L=T(a),F(f.$$.fragment,a),C=T(a),F(E.$$.fragment,a),q=T(a),F(y.$$.fragment,a)},m(a,c){k(r,a,c),h(a,s,c),k(e,a,c),h(a,l,c),k(m,a,c),h(a,o,c),k(R,a,c),h(a,L,c),k(f,a,c),h(a,C,c),k(E,a,c),h(a,q,c),k(y,a,c),O=!0},p:Z,i(a){O||(u(r.$$.fragment,a),u(e.$$.fragment,a),u(m.$$.fragment,a),u(R.$$.fragment,a),u(f.$$.fragment,a),u(E.$$.fragment,a),u(y.$$.fragment,a),O=!0)},o(a){$(r.$$.fragment,a),$(e.$$.fragment,a),$(m.$$.fragment,a),$(R.$$.fragment,a),$(f.$$.fragment,a),$(E.$$.fragment,a),$(y.$$.fragment,a),O=!1},d(a){a&&(d(s),d(l),d(o),d(L),d(C),d(q)),D(r,a),D(e,a),D(m,a),D(R,a),D(f,a),D(E,a),D(y,a)}}}function Je(i){let r,s;return r=new X({props:{id:"frts",title:"Runtime",fmt:"yyyy/mm/dd hh:MM:ss.000"}}),{c(){S(r.$$.fragment)},l(e){F(r.$$.fragment,e)},m(e,l){k(r,e,l),s=!0},p:Z,i(e){s||(u(r.$$.fragment,e),s=!0)},o(e){$(r.$$.fragment,e),s=!1},d(e){D(r,e)}}}function Xe(i){let r,s;return r=new He({props:{valueLabel:"All",value:"%%"}}),{c(){S(r.$$.fragment)},l(e){F(r.$$.fragment,e)},m(e,l){k(r,e,l),s=!0},p:Z,i(e){s||(u(r.$$.fragment,e),s=!0)},o(e){$(r.$$.fragment,e),s=!1},d(e){D(r,e)}}}function We(i){let r,s,e,l,m,o,R,L,f,C,E="#Hello world",q,y,O,a,c,G,Y,N,z,I,Q=i[0].selected_timestamp.value+"",P,K,H,V,M,A;function x(t,n){return Ke}let B=x()(i),w=i[1]&&ve(i),p=i[2]&&he(i),_=i[3]&&ye(i),g=i[4]&&be(i);return y=new $e({props:{data:i[1],$$slots:{default:[Ve]},$$scope:{ctx:i}}}),a=new $e({props:{data:i[3],$$slots:{default:[Je]},$$scope:{ctx:i}}}),G=new we({props:{data:i[3],title:"Select a Time to view",name:"selected_timestamp",value:"run_id",label:"frts"}}),N=new we({props:{data:i[4],title:"Select a route",name:"selected_route",value:"route_id",label:"route_short_name",$$slots:{default:[Xe]},$$scope:{ctx:i}}}),H=new je({props:{data:i[1],lat:"position_lat",long:"Position_lon",pointName:"trip_route",tooltipType:"hover",tooltip:[{id:"trip_route",showColumnName:!1,valueClass:"text-xl font-semibold"},{id:"trip_headsign",showColumnName:!1,valueClass:"text-xl font-semibold"},{id:"vehicle_id"}],"height:":!0,600:!0}}),M=new ze({props:{prefix:"Data last updated"}}),{c(){r=b(),B.c(),s=te("meta"),e=te("meta"),l=pe(),m=b(),w&&w.c(),o=b(),p&&p.c(),R=b(),_&&_.c(),L=b(),g&&g.c(),f=b(),C=te("p"),C.textContent=E,q=b(),S(y.$$.fragment),O=b(),S(a.$$.fragment),c=b(),S(G.$$.fragment),Y=b(),S(N.$$.fragment),z=b(),I=te("p"),P=me(Q),K=b(),S(H.$$.fragment),V=b(),S(M.$$.fragment),this.h()},l(t){r=T(t);const n=Re("svelte-1j2izld",document.head);B.l(n),s=re(n,"META",{name:!0,content:!0}),e=re(n,"META",{name:!0,content:!0}),l=pe(),n.forEach(d),m=T(t),w&&w.l(t),o=T(t),p&&p.l(t),R=T(t),_&&_.l(t),L=T(t),g&&g.l(t),f=T(t),C=re(t,"P",{class:!0,"data-svelte-h":!0}),Ee(C)!=="svelte-lhf3z3"&&(C.textContent=E),q=T(t),F(y.$$.fragment,t),O=T(t),F(a.$$.fragment,t),c=T(t),F(G.$$.fragment,t),Y=T(t),F(N.$$.fragment,t),z=T(t),I=re(t,"P",{class:!0});var j=Se(I);P=ue(j,Q),j.forEach(d),K=T(t),F(H.$$.fragment,t),V=T(t),F(M.$$.fragment,t),this.h()},h(){W(s,"name","twitter:card"),W(s,"content","summary"),W(e,"name","twitter:site"),W(e,"content","@evidence_dev"),W(C,"class","markdown"),W(I,"class","markdown")},m(t,n){h(t,r,n),B.m(document.head,null),ee(document.head,s),ee(document.head,e),ee(document.head,l),h(t,m,n),w&&w.m(t,n),h(t,o,n),p&&p.m(t,n),h(t,R,n),_&&_.m(t,n),h(t,L,n),g&&g.m(t,n),h(t,f,n),h(t,C,n),h(t,q,n),k(y,t,n),h(t,O,n),k(a,t,n),h(t,c,n),k(G,t,n),h(t,Y,n),k(N,t,n),h(t,z,n),h(t,I,n),ee(I,P),h(t,K,n),k(H,t,n),h(t,V,n),k(M,t,n),A=!0},p(t,n){B.p(t,n),t[1]?w?(w.p(t,n),n[0]&2&&u(w,1)):(w=ve(t),w.c(),u(w,1),w.m(o.parentNode,o)):w&&(ne(),$(w,1,1,()=>{w=null}),ie()),t[2]?p?(p.p(t,n),n[0]&4&&u(p,1)):(p=he(t),p.c(),u(p,1),p.m(R.parentNode,R)):p&&(ne(),$(p,1,1,()=>{p=null}),ie()),t[3]?_?(_.p(t,n),n[0]&8&&u(_,1)):(_=ye(t),_.c(),u(_,1),_.m(L.parentNode,L)):_&&(ne(),$(_,1,1,()=>{_=null}),ie()),t[4]?g?(g.p(t,n),n[0]&16&&u(g,1)):(g=be(t),g.c(),u(g,1),g.m(f.parentNode,f)):g&&(ne(),$(g,1,1,()=>{g=null}),ie());const j={};n[0]&2&&(j.data=t[1]),n[1]&256&&(j.$$scope={dirty:n,ctx:t}),y.$set(j);const v={};n[0]&8&&(v.data=t[3]),n[1]&256&&(v.$$scope={dirty:n,ctx:t}),a.$set(v);const ae={};n[0]&8&&(ae.data=t[3]),G.$set(ae);const le={};n[0]&16&&(le.data=t[4]),n[1]&256&&(le.$$scope={dirty:n,ctx:t}),N.$set(le),(!A||n[0]&1)&&Q!==(Q=t[0].selected_timestamp.value+"")&&Fe(P,Q);const fe={};n[0]&2&&(fe.data=t[1]),H.$set(fe)},i(t){A||(u(w),u(p),u(_),u(g),u(y.$$.fragment,t),u(a.$$.fragment,t),u(G.$$.fragment,t),u(N.$$.fragment,t),u(H.$$.fragment,t),u(M.$$.fragment,t),A=!0)},o(t){$(w),$(p),$(_),$(g),$(y.$$.fragment,t),$(a.$$.fragment,t),$(G.$$.fragment,t),$(N.$$.fragment,t),$(H.$$.fragment,t),$(M.$$.fragment,t),A=!1},d(t){t&&(d(r),d(m),d(o),d(R),d(L),d(f),d(C),d(q),d(O),d(c),d(Y),d(z),d(I),d(K),d(V)),B.d(t),d(s),d(e),d(l),w&&w.d(t),p&&p.d(t),_&&_.d(t),g&&g.d(t),D(y,t),D(a,t),D(G,t),D(N,t),D(H,t),D(M,t)}}}function Ze(i,r,s){let e,l;_e(i,Pe,v=>s(23,e=v)),_e(i,ce,v=>s(29,l=v));let{data:m}=r,{data:o={},customFormattingSettings:R,__db:L,inputs:f}=m;Ce(ce,l="4539330648b80f94ef3bf911f6d77ac9",l);let C=Oe(Le(f));qe(C.subscribe(v=>s(0,f=v))),Ie(Ae,{getCustomFormats:()=>R.customFormats||[]});const E=(v,ae)=>Ne(L.query,v,{query_name:ae});Ge(E);let q;const y=()=>{q||(q=setTimeout(()=>{ge.add({id:"LoadingToast",title:"",message:"Loading...",status:"info"},0)},3e3))},O=()=>{q?(clearTimeout(q),q=null):ge.dismiss("LoadingToast")};de(()=>(U.addEventListener("inFlightQueryStart",y),U.addEventListener("inFlightQueryEnd",O),U.QueriesLoading&&y(),()=>{U.removeEventListener("inFlightQueryStart",y),U.removeEventListener("inFlightQueryEnd",O)})),e.params,de(()=>!0);let a={initialData:void 0,initialError:void 0},c=J`select * from OCTData.feedmessage natural join GTFS.trips where run_id = '${f.selected_timestamp.value}' and trip_route = '${f.selected_route.value}'`,G=`select * from OCTData.feedmessage natural join GTFS.trips where run_id = '${f.selected_timestamp.value}' and trip_route = '${f.selected_route.value}'`;o.rawdata_data&&(o.rawdata_data instanceof Error?a.initialError=o.rawdata_data:a.initialData=o.rawdata_data,o.rawdata_columns&&(a.knownColumns=o.rawdata_columns));let Y,N=!1;const z=U.createReactive({callback:v=>{s(1,Y=v)},execFn:E},{id:"rawdata",...a});z(G,{noResolve:c,...a}),globalThis[Symbol.for("rawdata")]={get value(){return Y}};let I={initialData:void 0,initialError:void 0},Q=J`select shape_id from GTFS.trips where trip_id like '${f.selected_trip.value}'`,P=`select shape_id from GTFS.trips where trip_id like '${f.selected_trip.value}'`;o.trips_shapeid_data&&(o.trips_shapeid_data instanceof Error?I.initialError=o.trips_shapeid_data:I.initialData=o.trips_shapeid_data,o.trips_shapeid_columns&&(I.knownColumns=o.trips_shapeid_columns));let K,H=!1;const V=U.createReactive({callback:v=>{s(2,K=v)},execFn:E},{id:"trips_shapeid",...I});V(P,{noResolve:Q,...I}),globalThis[Symbol.for("trips_shapeid")]={get value(){return K}};let M={initialData:void 0,initialError:void 0},A=J`select distinct strftime(run_timestamp, '%B %-d %Y - %I:%M:%S %p') as frts, run_id from OCTData.feedmessage`,x="select distinct strftime(run_timestamp, '%B %-d %Y - %I:%M:%S %p') as frts, run_id from OCTData.feedmessage";o.timestamps_data&&(o.timestamps_data instanceof Error?M.initialError=o.timestamps_data:M.initialData=o.timestamps_data,o.timestamps_columns&&(M.knownColumns=o.timestamps_columns));let se,B=!1;const w=U.createReactive({callback:v=>{s(3,se=v)},execFn:E},{id:"timestamps",...M});w(x,{noResolve:A,...M}),globalThis[Symbol.for("timestamps")]={get value(){return se}};let p={initialData:void 0,initialError:void 0},_=J`select * from GTFS.routes`,g="select * from GTFS.routes";o.routes_data&&(o.routes_data instanceof Error?p.initialError=o.routes_data:p.initialData=o.routes_data,o.routes_columns&&(p.knownColumns=o.routes_columns));let t,n=!1;const j=U.createReactive({callback:v=>{s(4,t=v)},execFn:E},{id:"routes",...p});return j(g,{noResolve:_,...p}),globalThis[Symbol.for("routes")]={get value(){return t}},i.$$set=v=>{"data"in v&&s(5,m=v.data)},i.$$.update=()=>{i.$$.dirty[0]&32&&s(6,{data:o={},customFormattingSettings:R,__db:L}=m,o),i.$$.dirty[0]&64&&Qe.set(Object.keys(o).length>0),i.$$.dirty[0]&8388608&&e.params,i.$$.dirty[0]&1&&s(8,c=J`select * from OCTData.feedmessage natural join GTFS.trips where run_id = '${f.selected_timestamp.value}' and trip_route = '${f.selected_route.value}'`),i.$$.dirty[0]&1&&s(9,G=`select * from OCTData.feedmessage natural join GTFS.trips where run_id = '${f.selected_timestamp.value}' and trip_route = '${f.selected_route.value}'`),i.$$.dirty[0]&1920&&(c||!N?c||(z(G,{noResolve:c,...a}),s(10,N=!0)):z(G,{noResolve:c})),i.$$.dirty[0]&1&&s(12,Q=J`select shape_id from GTFS.trips where trip_id like '${f.selected_trip.value}'`),i.$$.dirty[0]&1&&s(13,P=`select shape_id from GTFS.trips where trip_id like '${f.selected_trip.value}'`),i.$$.dirty[0]&30720&&(Q||!H?Q||(V(P,{noResolve:Q,...I}),s(14,H=!0)):V(P,{noResolve:Q})),i.$$.dirty[0]&491520&&(A||!B?A||(w(x,{noResolve:A,...M}),s(18,B=!0)):w(x,{noResolve:A})),i.$$.dirty[0]&7864320&&(_||!n?_||(j(g,{noResolve:_,...p}),s(22,n=!0)):j(g,{noResolve:_}))},s(16,A=J`select distinct strftime(run_timestamp, '%B %-d %Y - %I:%M:%S %p') as frts, run_id from OCTData.feedmessage`),s(17,x="select distinct strftime(run_timestamp, '%B %-d %Y - %I:%M:%S %p') as frts, run_id from OCTData.feedmessage"),s(20,_=J`select * from GTFS.routes`),s(21,g="select * from GTFS.routes"),[f,Y,K,se,t,m,o,a,c,G,N,I,Q,P,H,M,A,x,B,p,_,g,n,e]}class ut extends ke{constructor(r){super(),De(this,r,Ze,We,Te,{data:5},null,[-1,-1])}}export{ut as component};
